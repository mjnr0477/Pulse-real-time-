import React, { useState, useEffect } from "react";
import { View, Text, TextInput, Button } from "react-native";
import { signInWithEmailAndPassword, onAuthStateChanged } from "firebase/auth";
import { auth } from "../firebase";

export default function LoginScreen({ navigation }) {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  // Redirect to Home if already logged in
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (user) => {
      if (user) navigation.replace("Home");
    });
    return unsubscribe;
  }, []);

  const handleLogin = async () => {
    try {
      await signInWithEmailAndPassword(auth, email.trim(), password);
    } catch (err) {
      alert(err.message);
    }
  };

  return (
    <View style={{ flex: 1, justifyContent: "center", padding: 20 }}>
      <Text style={{ fontSize: 24, textAlign: "center", marginBottom: 20 }}>Pulse Login</Text>
      <TextInput
        placeholder="Email"
        value={email}
        onChangeText={setEmail}
        keyboardType="email-address"
        autoCapitalize="none"
        style={{ borderBottomWidth: 1, marginBottom: 12 }}
      />
      <TextInput
        placeholder="Password"
        value={password}
        onChangeText={setPassword}
        secureTextEntry
        style={{ borderBottomWidth: 1, marginBottom: 20 }}
      />
      <Button title="Login" onPress={handleLogin} />
      <Text
        onPress={() => navigation.navigate("Register")}
        style={{ textAlign: "center", marginTop: 12 }}
      >
        Donâ€™t have an account? Register
      </Text>
    </View>
  );
}import React, { useState } from "react";
import { View, Text, TextInput, Button } from "react-native";
import { createUserWithEmailAndPassword, updateProfile } from "firebase/auth";
import { auth, db } from "../firebase";
import { setDoc, doc } from "firebase/firestore";

export default function RegisterScreen({ navigation }) {
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const handleRegister = async () => {
    try {
      const userCred = await createUserWithEmailAndPassword(auth, email.trim(), password);
      const user = userCred.user;
      await updateProfile(user, { displayName: name });
      await setDoc(doc(db, "users", user.uid), {
        uid: user.uid,
        name,
        email: user.email,
        createdAt: new Date().toISOString()
      });
      navigation.replace("Home");
    } catch (err) {
      alert(err.message);
    }
  };

  return (
    <View style={{ flex: 1, justifyContent: "center", padding: 20 }}>
      <Text style={{ fontSize: 24, textAlign: "center", marginBottom: 20 }}>Register on Pulse</Text>
      <TextInput
        placeholder="Name"
        value={name}
        onChangeText={setName}
        style={{ borderBottomWidth: 1, marginBottom: 12 }}
      />
      <TextInput
        placeholder="Email"
        value={email}
        onChangeText={setEmail}
        keyboardType="email-address"
        autoCapitalize="none"
        style={{ borderBottomWidth: 1, marginBottom: 12 }}
      />
      <TextInput
        placeholder="Password"
        value={password}
        onChangeText={setPassword}
        secureTextEntry
        style={{ borderBottomWidth: 1, marginBottom: 20 }}
      />
      <Button title="Register" onPress={handleRegister} />
      <Text
        onPress={() => navigation.navigate("Login")}
        style={{ textAlign: "center", marginTop: 12 }}
      >
        Already have an account? Login
      </Text>
    </View>
  );
}import React, { useEffect, useState } from "react";
import { View, Text, TextInput, Button, FlatList } from "react-native";
import { auth, db } from "../firebase";
import { signOut } from "firebase/auth";
import { addDoc, collection, onSnapshot, query, orderBy, serverTimestamp } from "firebase/firestore";

export default function HomeScreen({ navigation }) {
  const [content, setContent] = useState("");
  const [posts, setPosts] = useState([]);

  useEffect(() => {
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const unsubscribe = onSnapshot(q, (snapshot) => {
      setPosts(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
    });
    return unsubscribe;
  }, []);

  const handlePost = async () => {
    if (!content.trim()) return;
    try {
      await addDoc(collection(db, "posts"), {
        userId: auth.currentUser.uid,
        content: content.trim(),
        createdAt: serverTimestamp()
      });
      setContent("");
    } catch (err) {
      alert(err.message);
    }
  };

  const handleLogout = async () => {
    await signOut(auth);
    navigation.replace("Login");
  };

  return (
    <View style={{ flex: 1, padding: 16 }}>
      <Text style={{ fontSize: 22, textAlign: "center", marginBottom: 10 }}>ðŸ”¥ Pulse Feed</Text>
      <Button title="Logout" onPress={handleLogout} />
      <TextInput
        placeholder="What's new?"
        value={content}
        onChangeText={setContent}
        style={{ borderWidth: 1, padding: 10, marginVertical: 12 }}
      />
      <Button title="Post" onPress={handlePost} />
      <FlatList
        style={{ marginTop: 16 }}
        data={posts}
        keyExtractor={(item) => item.id}
        renderItem={({ item }) => (
          <View style={{ padding: 10, borderBottomWidth: 1 }}>
            <Text>{item.content}</Text>
            <Text style={{ fontSize: 11, color: "gray", marginTop: 6 }}>
              {item.createdAt?.toDate ? item.createdAt.toDate().toLocaleString() : ""}
            </Text>
          </View>
        )}
      />
    </View>
  );
}
